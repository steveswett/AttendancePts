<!DOCTYPE html>
<html>

<head>
<title>Test JIRA WebHook Status Change</title>

<script src="js/jquery-1.11.3.min.js"></script>


<!-- <link href="css/sms-style.css"	rel="stylesheet"> -->


	<script>

        $(document).ready(function() {
		
			$("#in_progress").hide();
			
        	$("#testLink").click(function() 
        	{

				console.log("testLink was clicked");
				
				/*
				$.post( "http://localhost:8888/servlet/JIRAWebHook/srq-status-change/ERP-1524", function( data ) {
					console.log("Data returned: " + data)
					$("#returnedDataSection").append(data);
				});
				*/

				
				/* 
				The "requestData" field isn't currently used, but I kept it around
				in case we decide to post something else from this set of formatted
				data.  
				*/
				   
				requestData = { 
	"id": 2,
 	"timestamp": "2009-09-09T00:08:36.796-0500",
	"issue": { 
		"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog",
		"id":"99291",
		"self":"https://jira.atlassian.com/rest/api/2/issue/99291",
		"key":"JRA-20002",
		"fields":{
			"summary":"I feel the need for speed",
			"created":"2009-12-16T23:46:10.612-0600",
			"description":"Make the issue nav load 10x faster",
			"labels":["UI", "dialogue", "move"],
			"priority": "Minor"
		}
	},
	"user": {
		"self":"https://jira.atlassian.com/rest/api/2/user?username=brollins",
		"name":"brollins",
		"emailAddress":"bryansemail at atlassian dot com",
		"avatarUrls":{
			"16x16":"https://jira.atlassian.com/secure/useravatar?size=small&avatarId=10605",
			"48x48":"https://jira.atlassian.com/secure/useravatar?avatarId=10605"
		},
		"displayName":"Bryan Rollins [Atlassian]",
		"active" : "true"
	},
  	"changelog": {
        "items": [
            {
                "toString": "A new summary.",
                "to": null,
                "fromString": "What is going on here?????",
                "from": null,
                "fieldtype": "jira",
                "field": "summary"
            },
            {
                "toString": "New Feature",
                "to": "2",
                "fromString": "Improvement",
                "from": "4",
                "fieldtype": "jira",
                "field": "issuetype"
            }
        ],
		"id": 10124
	},
	"comment" : {
		"self":"https://jira.atlassian.com/rest/api/2/issue/10148/comment/252789",
		"id":"252789",
		"author":{
			"self":"https://jira.atlassian.com/rest/api/2/user?username=brollins",
			"name":"brollins",
			"emailAddress":"bryansemail@atlassian.com",
			"avatarUrls":{
				"16x16":"https://jira.atlassian.com/secure/useravatar?size=small&avatarId=10605",
				"48x48":"https://jira.atlassian.com/secure/useravatar?avatarId=10605"
			},
			"displayName":"Bryan Rollins [Atlassian]",
			"active":true
		},
		"body":"Just in time for AtlasCamp!",
		"updateAuthor":{
			"self":"https://jira.atlassian.com/rest/api/2/user?username=brollins",
			"name":"brollins",
			"emailAddress":"brollins@atlassian.com",
			"avatarUrls":{
				"16x16":"https://jira.atlassian.com/secure/useravatar?size=small&avatarId=10605",
				"48x48":"https://jira.atlassian.com/secure/useravatar?avatarId=10605"
			},
			"displayName":"Bryan Rollins [Atlassian]",
			"active":true
		},
		"created":"2011-06-07T10:31:26.805-0500",
		"updated":"2011-06-07T10:31:26.805-0500"
	},  
	"timestamp": "2011-06-07T10:31:26.805-0500",
    "webhookEvent": "jira:issue_updated"
};


				transitionRequestData = {
				"transition":
					{
					"workflowId":14132,
					"workflowName":"ERP: Software Development Workflow",
					"transitionId":151,
					"transitionName":"Done",
					"from_status":"In Progress",
					"to_status":"Done"
					},
				"comment":"This is my Done Resolution comment.",
				"user":
					{"self":"https://notionsmarketing.atlassian.net/rest/api/2/user?username=steve.swett",
					"name":"steve.swett",
					"key":"steve.swett",
					"emailAddress":"steve.swett@notionsmarketing.com",
					"avatarUrls":
						{"48x48":"https://notionsmarketing.atlassian.net/secure/useravatar?ownerId=steve.swett&avatarId=10900",
						"24x24":"https://notionsmarketing.atlassian.net/secure/useravatar?size=small&ownerId=steve.swett&avatarId=10900",
						"16x16":"https://notionsmarketing.atlassian.net/secure/useravatar?size=xsmall&ownerId=steve.swett&avatarId=10900",
						"32x32":"https://notionsmarketing.atlassian.net/secure/useravatar?size=medium&ownerId=steve.swett&avatarId=10900"
						},
					"displayName":"Steve Swett",
					"active":true,
					"timeZone":"America/New_York"
					},
				"issue":{
					"id":"14031",
					"self":"https://notionsmarketing.atlassian.net/rest/api/2/issue/14031",
					"key":"ERP-1587",
					"fields":
						{
						"issuetype":
							{
							"self":"https://notionsmarketing.atlassian.net/rest/api/2/issuetype/10200",
							"id":"10200",
							"description":"",
							"iconUrl":"https://notionsmarketing.atlassian.net/secure/viewavatar?size=xsmall&avatarId=10300&avatarType=issuetype",
							"name":"Break Fix",
							"subtask":false,
							"avatarId":10300
							},
						"timespent":null,"project":{
							"self":"https://notionsmarketing.atlassian.net/rest/api/2/project/10600",
							"id":"10600",
							"key":"ERP",
							"name":"Notions Proprietary ERP",
							"avatarUrls":{
								"48x48":"https://notionsmarketing.atlassian.net/secure/projectavatar?pid=10600&avatarId=10011",
								"24x24":"https://notionsmarketing.atlassian.net/secure/projectavatar?size=small&pid=10600&avatarId=10011",
								"16x16":"https://notionsmarketing.atlassian.net/secure/projectavatar?size=xsmall&pid=10600&avatarId=10011",
								"32x32":"https://notionsmarketing.atlassian.net/secure/projectavatar?size=medium&pid=10600&avatarId=10011"
								}
							},
						"fixVersions":[],
						"customfield_10110":null,
						"customfield_10111":null,
						"aggregatetimespent":null,
						"resolution":{
							"self":"https://notionsmarketing.atlassian.net/rest/api/2/resolution/1",
							"id":"1",
							"description":"A fix for this issue is checked into the tree and tested.",
							"name":"Fixed"
							},
						"customfield_10112":null,
						"customfield_10113":"Not started",
						"customfield_10114":null,
						"customfield_10500":null,
						"customfield_10104":null,
						"customfield_10105":null,
						"customfield_10106":null,
						"customfield_10107":null,
						"customfield_10108":null,
						"customfield_10109":null,
						"resolutiondate":"2015-10-08T11:26:59.469-0400",
						"workratio":-1,
						"lastViewed":"2015-10-08T11:26:59.458-0400",
						"watches":{
							"self":"https://notionsmarketing.atlassian.net/rest/api/2/issue/ERP-1587/watchers",
							"watchCount":3,
							"isWatching":true
							},
						"created":"2015-10-08T07:51:07.232-0400",
						"priority":{
							"self":"https://notionsmarketing.atlassian.net/rest/api/2/priority/10000",
							"iconUrl":"https://notionsmarketing.atlassian.net/images/icons/priorities/trivial.svg",
							"name":"TBD","id":"10000"
							},
						"customfield_10100":null,
						"customfield_10101":"2015-10-08T08:20:27.846-0400",
						"customfield_10102":"3_*:*_7_*:*_435638_*|*_10000_*:*_2_*:*_2726585_*|*_10002_*:*_7_*:*_9784361",
						"customfield_10300":null,
						"customfield_10103":null,
						"labels":[],
						"timeestimate":null,
						"aggregatetimeoriginalestimate":null,
						"versions":[],
						"issuelinks":[],
						"assignee":{
							"self":"https://notionsmarketing.atlassian.net/rest/api/2/user?username=steve.swett",
							"name":"steve.swett",
							"key":"steve.swett",
							"emailAddress":"steve.swett@notionsmarketing.com",
							"avatarUrls":{
								"48x48":"https://notionsmarketing.atlassian.net/secure/useravatar?ownerId=steve.swett&avatarId=10900",
								"24x24":"https://notionsmarketing.atlassian.net/secure/useravatar?size=small&ownerId=steve.swett&avatarId=10900",
								"16x16":"https://notionsmarketing.atlassian.net/secure/useravatar?size=xsmall&ownerId=steve.swett&avatarId=10900",
								"32x32":"https://notionsmarketing.atlassian.net/secure/useravatar?size=medium&ownerId=steve.swett&avatarId=10900"
								},
							"displayName":"Steve Swett",
							"active":true,
							"timeZone":"America/New_York"
							},
						"updated":"2015-10-08T11:26:53.815-0400",
						"status":{
							"self":"https://notionsmarketing.atlassian.net/rest/api/2/status/3",
							"description":"This issue is being actively worked on at the moment by the assignee.",
							"iconUrl":"https://notionsmarketing.atlassian.net/images/icons/statuses/inprogress.png",
							"name":"In Progress",
							"id":"3",
							"statusCategory":{
								"self":"https://notionsmarketing.atlassian.net/rest/api/2/statuscategory/4",
								"id":4,
								"key":"indeterminate",
								"colorName":"yellow",
								"name":"In Progress"
							}
						},
					"components":[],
					"timeoriginalestimate":null,
					"description":"Subject: KBD SHIFT LOCK LIGHT NOT ON\r\nContact: Steve Swett\r\n Needed: now\r\n\r\nMy keyboard shift lock light won't come on. Yeah, I know this is really hardware. Yeah, I know it's bogus.\r\n",
					"customfield_10010":"0|i00fkv:",
					"customfield_10011":null,
					"timetracking":{},
					"customfield_10005":null,
					"customfield_10006":null,
					"attachment":[],
					"aggregatetimeestimate":null,
					"summary":"KBD SHIFT LOCK LIGHT NOT ON - **NEW 2** SRQ:031444",
					"creator":{
						"self":"https://notionsmarketing.atlassian.net/rest/api/2/user?username=Wyatt ERP","name":"Wyatt ERP","key":"wyatt erp","emailAddress":"jira-erp-issues@notionsmarketing.com","avatarUrls":{"48x48":"https://notionsmarketing.atlassian.net/secure/useravatar?ownerId=wyatt erp&avatarId=10601","24x24":"https://notionsmarketing.atlassian.net/secure/useravatar?size=small&ownerId=wyatt erp&avatarId=10601","16x16":"https://notionsmarketing.atlassian.net/secure/useravatar?size=xsmall&ownerId=wyatt erp&avatarId=10601","32x32":"https://notionsmarketing.atlassian.net/secure/useravatar?size=medium&ownerId=wyatt erp&avatarId=10601"},"displayName":"Wyatt ERP","active":true,"timeZone":"America/New_York"},"subtasks":[],"reporter":{"self":"https://notionsmarketing.atlassian.net/rest/api/2/user?username=Wyatt ERP","name":"Wyatt ERP","key":"wyatt erp","emailAddress":"jira-erp-issues@notionsmarketing.com","avatarUrls":{"48x48":"https://notionsmarketing.atlassian.net/secure/useravatar?ownerId=wyatt erp&avatarId=10601","24x24":"https://notionsmarketing.atlassian.net/secure/useravatar?size=small&ownerId=wyatt erp&avatarId=10601","16x16":"https://notionsmarketing.atlassian.net/secure/useravatar?size=xsmall&ownerId=wyatt erp&avatarId=10601","32x32":"https://notionsmarketing.atlassian.net/secure/useravatar?size=medium&ownerId=wyatt erp&avatarId=10601"},"displayName":"Wyatt ERP","active":true,"timeZone":"America/New_York"},"customfield_10000":null,"aggregateprogress":{"progress":0,"total":0},"customfield_10001":null,"customfield_10200":null,"customfield_10003":null,"customfield_10400":null,"customfield_10115":null,"customfield_10116":[],"environment":null,"duedate":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":2,"total":2,"comments":[{"self":"https://notionsmarketing.atlassian.net/rest/api/2/issue/14031/comment/15384","id":"15384","author":{"self":"https://notionsmarketing.atlassian.net/rest/api/2/user?username=tim.maycroft","name":"tim.maycroft","key":"tim.maycroft","emailAddress":"tim.maycroft@notionsmarketing.com","avatarUrls":{"48x48":"https://secure.gravatar.com/avatar/7d31c29266ef588eaa5f62e583772a7d?d=mm&s=48","24x24":"https://secure.gravatar.com/avatar/7d31c29266ef588eaa5f62e583772a7d?d=mm&s=24","16x16":"https://secure.gravatar.com/avatar/7d31c29266ef588eaa5f62e583772a7d?d=mm&s=16","32x32":"https://secure.gravatar.com/avatar/7d31c29266ef588eaa5f62e583772a7d?d=mm&s=32"},"displayName":"Tim Maycroft","active":true,"timeZone":"America/New_York"},"body":"You need a Motel 6 keyboard","updateAuthor":{"self":"https://notionsmarketing.atlassian.net/rest/api/2/user?username=tim.maycroft","name":"tim.maycroft","key":"tim.maycroft","emailAddress":"tim.maycroft@notionsmarketing.com","avatarUrls":{"48x48":"https://secure.gravatar.com/avatar/7d31c29266ef588eaa5f62e583772a7d?d=mm&s=48","24x24":"https://secure.gravatar.com/avatar/7d31c29266ef588eaa5f62e583772a7d?d=mm&s=24","16x16":"https://secure.gravatar.com/avatar/7d31c29266ef588eaa5f62e583772a7d?d=mm&s=16","32x32":"https://secure.gravatar.com/avatar/7d31c29266ef588eaa5f62e583772a7d?d=mm&s=32"},"displayName":"Tim Maycroft","active":true,"timeZone":"America/New_York"},"created":"2015-10-08T08:20:27.846-0400","updated":"2015-10-08T08:20:27.846-0400"},{"self":"https://notionsmarketing.atlassian.net/rest/api/2/issue/14031/comment/15386","id":"15386","author":{"self":"https://notionsmarketing.atlassian.net/rest/api/2/user?username=steve.swett","name":"steve.swett","key":"steve.swett","emailAddress":"steve.swett@notionsmarketing.com","avatarUrls":{"48x48":"https://notionsmarketing.atlassian.net/secure/useravatar?ownerId=steve.swett&avatarId=10900","24x24":"https://notionsmarketing.atlassian.net/secure/useravatar?size=small&ownerId=steve.swett&avatarId=10900","16x16":"https://notionsmarketing.atlassian.net/secure/useravatar?size=xsmall&ownerId=steve.swett&avatarId=10900","32x32":"https://notionsmarketing.atlassian.net/secure/useravatar?size=medium&ownerId=steve.swett&avatarId=10900"},"displayName":"Steve Swett","active":true,"timeZone":"America/New_York"},"body":":D -- testing the JIRA WebHooks with this one.","updateAuthor":{"self":"https://notionsmarketing.atlassian.net/rest/api/2/user?username=steve.swett","name":"steve.swett","key":"steve.swett","emailAddress":"steve.swett@notionsmarketing.com","avatarUrls":{"48x48":"https://notionsmarketing.atlassian.net/secure/useravatar?ownerId=steve.swett&avatarId=10900","24x24":"https://notionsmarketing.atlassian.net/secure/useravatar?size=small&ownerId=steve.swett&avatarId=10900","16x16":"https://notionsmarketing.atlassian.net/secure/useravatar?size=xsmall&ownerId=steve.swett&avatarId=10900","32x32":"https://notionsmarketing.atlassian.net/secure/useravatar?size=medium&ownerId=steve.swett&avatarId=10900"},"displayName":"Steve Swett","active":true,"timeZone":"America/New_York"},"created":"2015-10-08T08:37:50.804-0400","updated":"2015-10-08T08:37:50.804-0400"}]},"votes":{"self":"https://notionsmarketing.atlassian.net/rest/api/2/issue/ERP-1587/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]}}},"timestamp":1444318019480};


				$("#in_progress").show();
						
				$.post( "http://localhost:8888/servlet/JIRAWebHook/srq-status-change/ERP-1524", JSON.stringify(transitionRequestData), function( data ) {
					console.log("Data returned: " + data);
					$("#returnedDataSection").append(data);
					$("#in_progress").hide();
				});
				
			});
        });

    </script>


</head>

<body>

	<div id="tpsPageContainer">

		<p>This test page is used to do a webhook test for a status change. jQuery is
			used to make a POST request to a REST service, which returns a JSON
			response.</p>

			
	<div id="inputDiv">

			Click <a href="#" id="testLink">here</a> to run the test.
		
	</div>		

	
	<div id="outputDiv">
	
		<p id="in_progress">Data is being posted ... please wait</p>

		<p>Data returned from servlet:</p>

		<div id="returnedDataSection"></div>
		
	</div>


	</div>
	
</body>
	
</html>