REM /**
REM  * TestOrgJSONJiraRest.bbj
REM  * @author stevett
REM  *
REM  */

use org.json.JSONObject
use org.json.JSONArray

declare org.json.JSONObject rootObject!
declare org.json.JSONObject transitionObject!
declare org.json.JSONObject userObject!
declare org.json.JSONObject issueObject!
declare org.json.JSONObject issueFieldsObject!

begin

    jsonData$ = "{""transition"":{""workflowId"":14132,""workflowName"":""ERP: Software Development Workflow"",""transitionId"":21,""transitionName"":""Done"",""from_status"":""To Do"",""to_status"":""Done""},""comment"":"""",""user"":{""self"":""https://notionsmarketing.atlassian.net/rest/api/2/user?username=steve.swett"",""name"":""steve.swett"",""key"":""steve.swett"",""emailAddress"":""steve.swett@notionsmarketing.com"",""avatarUrls"":{""48x48"":""https://notionsmarketing.atlassian.net/secure/useravatar?ownerId=steve.swett&avatarId=10900"",""24x24"":""https://notionsmarketing.atlassian.net/secure/useravatar?size=small&ownerId=steve.swett&avatarId=10900"",""16x16"":""https://notionsmarketing.atlassian.net/secure/useravatar?size=xsmall&ownerId=steve.swett&avatarId=10900"",""32x32"":""https://notionsmarketing.atlassian.net/secure/useravatar?size=medium&ownerId=steve.swett&avatarId=10900""},""displayName"":""Steve Swett"",""active"":true,""timeZone"":""America/New_York""},""issue"":{""id"":""14031"",""self"":""https://notionsmarketing.atlassian.net/rest/api/2/issue/14031"",""key"":""ERP-1587"",""fields"":{""issuetype"":{""self"":""https://notionsmarketing.atlassian.net/rest/api/2/issuetype/10200"",""id"":""10200"",""description"":"""",""iconUrl"":""https://notionsmarketing.atlassian.net/secure/viewavatar?size=xsmall&avatarId=10300&avatarType=issuetype"",""name"":""Break Fix"",""subtask"":false,""avatarId"":10300},""timespent"":null,""project"":{""self"":""https://notionsmarketing.atlassian.net/rest/api/2/project/10600"",""id"":""10600"",""key"":""ERP"",""name"":""Notions Proprietary ERP"",""avatarUrls"":{""48x48"":""https://notionsmarketing.atlassian.net/secure/projectavatar?pid=10600&avatarId=10011"",""24x24"":""https://notionsmarketing.atlassian.net/secure/projectavatar?size=small&pid=10600&avatarId=10011"",""16x16"":""https://notionsmarketing.atlassian.net/secure/projectavatar?size=xsmall&pid=10600&avatarId=10011"",""32x32"":""https://notionsmarketing.atlassian.net/secure/projectavatar?size=medium&pid=10600&avatarId=10011""}},""fixVersions"":[],""customfield_10110"":null,""customfield_10111"":null,""aggregatetimespent"":null,""resolution"":{""self"":""https://notionsmarketing.atlassian.net/rest/api/2/resolution/1"",""id"":""1"",""description"":""A fix for this issue is checked into the tree and tested."",""name"":""Fixed""},""customfield_10112"":null,""customfield_10113"":""Not started"",""customfield_10114"":null,""customfield_10500"":null,""customfield_10104"":null,""customfield_10105"":null,""customfield_10106"":null,""customfield_10107"":null,""customfield_10108"":null,""customfield_10109"":null,""resolutiondate"":""2015-10-09T08:49:47.656-0400"",""workratio"":-1,""lastViewed"":""2015-10-09T08:49:47.649-0400"",""watches"":{""self"":""https://notionsmarketing.atlassian.net/rest/api/2/issue/ERP-1587/watchers"",""watchCount"":3,""isWatching"":true},""created"":""2015-10-08T07:51:07.232-0400"",""priority"":{""self"":""https://notionsmarketing.atlassian.net/rest/api/2/priority/10000"",""iconUrl"":""https://notionsmarketing.atlassian.net/images/icons/priorities/trivial.svg"",""name"":""TBD"",""id"":""10000""},""customfield_10100"":null,""customfield_10101"":""2015-10-08T08:20:27.846-0400"",""customfield_10102"":""3_*:*_9_*:*_452911_*|*_10000_*:*_3_*:*_2726585_*|*_10002_*:*_10_*:*_86734214"",""customfield_10300"":null,""customfield_10103"":null,""labels"":[],""timeestimate"":null,""aggregatetimeoriginalestimate"":null,""versions"":[],""issuelinks"":[],""assignee"":{""self"":""https://notionsmarketing.atlassian.net/rest/api/2/user?username=steve.swett"",""name"":""steve.swett"",""key"":""steve.swett"",""emailAddress"":""steve.swett@notionsmarketing.com"",""avatarUrls"":{""48x48"":""https://notionsmarketing.atlassian.net/secure/useravatar?ownerId=steve.swett&avatarId=10900"",""24x24"":""https://notionsmarketing.atlassian.net/secure/useravatar?size=small&ownerId=steve.swett&avatarId=10900"",""16x16"":""https://notionsmarketing.atlassian.net/secure/useravatar?size=xsmall&ownerId=steve.swett&avatarId=10900"",""32x32"":""https://notionsmarketing.atlassian.net/secure/useravatar?size=medium&ownerId=steve.swett&avatarId=10900""},""displayName"":""Steve Swett"",""active"":true,""timeZone"":""America/New_York""},""updated"":""2015-10-09T08:49:40.942-0400"",""status"":{""self"":""https://notionsmarketing.atlassian.net/rest/api/2/status/10000"",""description"":"""",""iconUrl"":""https://notionsmarketing.atlassian.net/images/icons/statuses/open.png"",""name"":""To Do"",""id"":""10000"",""statusCategory"":{""self"":""https://notionsmarketing.atlassian.net/rest/api/2/statuscategory/2"",""id"":2,""key"":""new"",""colorName"":""blue-gray"",""name"":""To Do""}},""components"":[],""timeoriginalestimate"":null,""description"":""Subject: KBD SHIFT LOCK LIGHT NOT ON\r\nContact: Steve Swett\r\n Needed: now\r\n\r\nMy keyboard shift lock light won't come on. Yeah, I know this is really hardware. Yeah, I know it's bogus.\r\n"",""customfield_10010"":""0|i00fkv:"",""customfield_10011"":null,""timetracking"":{},""customfield_10005"":null,""customfield_10006"":null,""attachment"":[],""aggregatetimeestimate"":null,""summary"":""KBD SHIFT LOCK LIGHT NOT ON - **NEW 2** SRQ:030037"",""creator"":{""self"":""https://notionsmarketing.atlassian.net/rest/api/2/user?username=Wyatt ERP"",""name"":""Wyatt ERP"",""key"":""wyatt erp"",""emailAddress"":""jira-erp-issues@notionsmarketing.com"",""avatarUrls"":{""48x48"":""https://notionsmarketing.atlassian.net/secure/useravatar?ownerId=wyatt erp&avatarId=10601"",""24x24"":""https://notionsmarketing.atlassian.net/secure/useravatar?size=small&ownerId=wyatt erp&avatarId=10601"",""16x16"":""https://notionsmarketing.atlassian.net/secure/useravatar?size=xsmall&ownerId=wyatt erp&avatarId=10601"",""32x32"":""https://notionsmarketing.atlassian.net/secure/useravatar?size=medium&ownerId=wyatt erp&avatarId=10601""},""displayName"":""Wyatt ERP"",""active"":true,""timeZone"":""America/New_York""},""subtasks"":[],""reporter"":{""self"":""https://notionsmarketing.atlassian.net/rest/api/2/user?username=Wyatt ERP"",""name"":""Wyatt ERP"",""key"":""wyatt erp"",""emailAddress"":""jira-erp-issues@notionsmarketing.com"",""avatarUrls"":{""48x48"":""https://notionsmarketing.atlassian.net/secure/useravatar?ownerId=wyatt erp&avatarId=10601"",""24x24"":""https://notionsmarketing.atlassian.net/secure/useravatar?size=small&ownerId=wyatt erp&avatarId=10601"",""16x16"":""https://notionsmarketing.atlassian.net/secure/useravatar?size=xsmall&ownerId=wyatt erp&avatarId=10601"",""32x32"":""https://notionsmarketing.atlassian.net/secure/useravatar?size=medium&ownerId=wyatt erp&avatarId=10601""},""displayName"":""Wyatt ERP"",""active"":true,""timeZone"":""America/New_York""},""customfield_10000"":null,""aggregateprogress"":{""progress"":0,""total"":0},""customfield_10001"":null,""customfield_10200"":null,""customfield_10003"":null,""customfield_10400"":null,""customfield_10115"":null,""customfield_10116"":[],""environment"":null,""duedate"":null,""progress"":{""progress"":0,""total"":0},""comment"":{""startAt"":0,""maxResults"":2,""total"":2,""comments"":[{""self"":""https://notionsmarketing.atlassian.net/rest/api/2/issue/14031/comment/15384"",""id"":""15384"",""author"":{""self"":""https://notionsmarketing.atlassian.net/rest/api/2/user?username=tim.maycroft"",""name"":""tim.maycroft"",""key"":""tim.maycroft"",""emailAddress"":""tim.maycroft@notionsmarketing.com"",""avatarUrls"":{""48x48"":""https://secure.gravatar.com/avatar/7d31c29266ef588eaa5f62e583772a7d?d=mm&s=48"",""24x24"":""https://secure.gravatar.com/avatar/7d31c29266ef588eaa5f62e583772a7d?d=mm&s=24"",""16x16"":""https://secure.gravatar.com/avatar/7d31c29266ef588eaa5f62e583772a7d?d=mm&s=16"",""32x32"":""https://secure.gravatar.com/avatar/7d31c29266ef588eaa5f62e583772a7d?d=mm&s=32""},""displayName"":""Tim Maycroft"",""active"":true,""timeZone"":""America/New_York""},""body"":""You need a Motel 6 keyboard"",""updateAuthor"":{""self"":""https://notionsmarketing.atlassian.net/rest/api/2/user?username=tim.maycroft"",""name"":""tim.maycroft"",""key"":""tim.maycroft"",""emailAddress"":""tim.maycroft@notionsmarketing.com"",""avatarUrls"":{""48x48"":""https://secure.gravatar.com/avatar/7d31c29266ef588eaa5f62e583772a7d?d=mm&s=48"",""24x24"":""https://secure.gravatar.com/avatar/7d31c29266ef588eaa5f62e583772a7d?d=mm&s=24"",""16x16"":""https://secure.gravatar.com/avatar/7d31c29266ef588eaa5f62e583772a7d?d=mm&s=16"",""32x32"":""https://secure.gravatar.com/avatar/7d31c29266ef588eaa5f62e583772a7d?d=mm&s=32""},""displayName"":""Tim Maycroft"",""active"":true,""timeZone"":""America/New_York""},""created"":""2015-10-08T08:20:27.846-0400"",""updated"":""2015-10-08T08:20:27.846-0400""},{""self"":""https://notionsmarketing.atlassian.net/rest/api/2/issue/14031/comment/15386"",""id"":""15386"",""author"":{""self"":""https://notionsmarketing.atlassian.net/rest/api/2/user?username=steve.swett"",""name"":""steve.swett"",""key"":""steve.swett"",""emailAddress"":""steve.swett@notionsmarketing.com"",""avatarUrls"":{""48x48"":""https://notionsmarketing.atlassian.net/secure/useravatar?ownerId=steve.swett&avatarId=10900"",""24x24"":""https://notionsmarketing.atlassian.net/secure/useravatar?size=small&ownerId=steve.swett&avatarId=10900"",""16x16"":""https://notionsmarketing.atlassian.net/secure/useravatar?size=xsmall&ownerId=steve.swett&avatarId=10900"",""32x32"":""https://notionsmarketing.atlassian.net/secure/useravatar?size=medium&ownerId=steve.swett&avatarId=10900""},""displayName"":""Steve Swett"",""active"":true,""timeZone"":""America/New_York""},""body"":"":D -- testing the JIRA WebHooks with this one."",""updateAuthor"":{""self"":""https://notionsmarketing.atlassian.net/rest/api/2/user?username=steve.swett"",""name"":""steve.swett"",""key"":""steve.swett"",""emailAddress"":""steve.swett@notionsmarketing.com"",""avatarUrls"":{""48x48"":""https://notionsmarketing.atlassian.net/secure/useravatar?ownerId=steve.swett&avatarId=10900"",""24x24"":""https://notionsmarketing.atlassian.net/secure/useravatar?size=small&ownerId=steve.swett&avatarId=10900"",""16x16"":""https://notionsmarketing.atlassian.net/secure/useravatar?size=xsmall&ownerId=steve.swett&avatarId=10900"",""32x32"":""https://notionsmarketing.atlassian.net/secure/useravatar?size=medium&ownerId=steve.swett&avatarId=10900""},""displayName"":""Steve Swett"",""active"":true,""timeZone"":""America/New_York""},""created"":""2015-10-08T08:37:50.804-0400"",""updated"":""2015-10-08T08:37:50.804-0400""}]},""votes"":{""self"":""https://notionsmarketing.atlassian.net/rest/api/2/issue/ERP-1587/votes"",""votes"":0,""hasVoted"":false},""worklog"":{""startAt"":0,""maxResults"":20,""total"":0,""worklogs"":[]}}},""timestamp"":1444394987665}"
    
    seterr my_error_handler
    
    rootObject! = new org.json.JSONObject(jsonData$)
    
    REM  The following isn't need for data reading; it's about testing the structure of the JSON data
    transitionObject! = rootObject!.getJSONObject("transition")
    userObject! = rootObject!.getJSONObject("user")
    
    REM  These are needed for data reads:
    issueObject! = rootObject!.getJSONObject("issue")
    issueKey$ = issueObject!.getString("key")
    issueFieldsObject! = issueObject!.getJSONObject("fields")
    issueSummary$ = issueFieldsObject!.getString("summary")
     
    print "issueKey$ = ", issueKey$
    print "issueSummary$ = ", issueSummary$
    
    goto eoj
    
    
    my_error_handler:
    
    print "ERROR: ", errmes(-1)
    
    
    eoj:

end
